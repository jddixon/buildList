<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>buildList</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="css/main.css" />
  <link rel="stylesheet" type="text/css" href="css/normalize.css" />
  <link rel="stylesheet" type="text/css" href="css/ghp.css" />
</head>
<body>
<div class="content">
<h1 class="libTop">buildList</h1>

<p>A set of Python utilities intended to be interoperable with the
<strong>builds/</strong> package in <a href="https://github.com/jddixon/xlCrypto_go">https://github.com/jddixon/xlCrypto_go</a>.</p>

<h2>Serialization</h2>

<p>In its serialized form a BuildList consists of</p>

<ul>
<li>a public key line,</li>
<li>a title line,</li>
<li>a timestamp line,</li>
<li>a number of content lines, and</li>
<li>optionally a digital signature.</li>
</ul>

<p>Each of the lines ends with a linefeed (a byte with the value 10,
conventionally written as <code>\\n</code>).</p>

<p>A blank line follows the last content line.  The timestamp (in
CCYY-MM-DD HH:MM:SS form) represents the time at which the list
was signed using the RSA private key corresponding to the key in
the public key line.  The public key itself is base-64 encoded.</p>

<h2>Content Lines</h2>

<p>The content lines section begins and ends with fixed <code># BEGIN CONTENT #</code>
and <code># END CONTENT #</code> delimiters.  Each actual content line consists of</p>

<ul>
<li>either a directory name or</li>
<li>a file name followed by its content hash written as a hexadecimal string</li>
</ul>

<p>In either case the name
is indented by a number of spaces equivalent to its depth in the hierarchy.</p>

<pre><code># BEGIN CONTENT #
dir1
 fileForHash0 0123456789012345678901234567890123456789
 fileForHash1 abcdef0123456789abcdef0123456789abcdef01
 dir11
  fileForHash2 12abcdef0123456789abcdef0123456789abcdef
  fileForHash3 3456abcdef0123456789abcdef0123456789abcd
# END CONTENT #
</code></pre>

<p>That is, the data structure between the BEGIN/END CONTENT lines is an
<a href="http://jddixon.github.io/nlhtree_py">NLHTree</a>.</p>

<h2>Digital Signature</h2>

<p>The SHA1withRSA digital signature is over the entire SignedList excluding
the digital signature line and the blank line preceding it.  All line
endings are converted to LF (<code>\\n</code>) before taking the digital signature.</p>

<h2>Extended Hash</h2>

<p>The BuildList itself has a 20-byte extended hash, the 20-byte SHA1
digest of a function of the public key and the title.  This means
that the owner of the RSA key can create any number of documents
with the same hash but different timestamps with the intention
being that users can choose to regard the document with the most
recent timestamp as current.</p>

<h2>Utilities</h2>

<h3>blBootStrap</h3>

<p>A utility for use in testing the buildList package.</p>

<pre><code>usage: blBootstrap [-h] [-e EXDIR] [-f] [-j] [-T] [-v]

generate a sample data tree, write a build list, and create a corresponding
content-keyed store

optional arguments:
  -h, --help            show this help message and exit
  -e EXDIR, --exDir EXDIR
                        example directory, defaults to example/
  -f, --force           overwrite any existing example/ directory
  -j, --justShow        show options and exit
  -T, --testing         this is a test run
  -v, --verbose         be chatty
</code></pre>

<h3>blCheck</h3>

<pre><code>usage: blCheck [-h] [-1] [-b LISTFILE] [-j] [-r ROOTDIR] [-u UDIR] [-v]

verify integrity of build list, optionally agains root dir and uDir&quot;

optional arguments:
  -h, --help            show this help message and exit
  -1, --usingSHA1       using the 160-bit SHA1 hash
  -b LISTFILE, --listFile LISTFILE
                        root directory for build list
  -j, --justShow        show options and exit
  -r ROOTDIR, --rootDir ROOTDIR
                        root directory for build list
  -u UDIR, --uDir UDIR  path to uDir
  -v, --verbose         be chatty
</code></pre>

<h3>blListGen</h3>

<p>Given a source directory specified by <code>-r</code>, writes a buildList to <code>listFile</code>.</p>

<p>If the <code>-u</code> option is present, that is a directory for the storage of files
by content key; <code>blListGen</code> will copy each file in the build list into that
directory if it is not already present.</p>

<p>It is usually important to skip some files, <strong>not</strong> adding them to the
buildList and the backup directory; such files are
specified with the <code>-X</code> option.</p>

<pre><code>usage: blListGen [-h] [-1] [-b LISTFILE] [-j] [-k KEYFILE] [-P MATCHPAT]
                 [-r ROOTDIR] [-s] [-T] [-t TITLE] [-u UDIR] [-v] [-X EXCLUDE]

generate build list for directory, optionally populating uDir

optional arguments:
  -h, --help            show this help message and exit
  -1, --usingSHA1       use SHA1 in building merkletree (default=false=use
                        SHA256)
  -b LISTFILE, --listFile LISTFILE
                        path to build list
  -j, --justShow        show options and exit
  -k KEYFILE, --keyFile KEYFILE
                        path to RSA private key for signing
  -P MATCHPAT, --matchPat MATCHPAT
                        include only files matching this pattern
  -r ROOTDIR, --rootDir ROOTDIR
                        root directory for build list (REQUIRED)
  -s, --signing         digitally sign the generated BuildList
  -T, --testing         this is a test run
  -t TITLE, --title TITLE
                        title for build list
  -u UDIR, --uDir UDIR  path to uDir (relative to tmp/ if testing)
  -v, --verbose         be chatty
  -X EXCLUDE, --exclude EXCLUDE
                        exclude files matching this pattern
</code></pre>

<h3>blSrcGen</h3>

<p>This utility is complementary to <code>blListGen</code>: given a build list and
a backup directory indexed by content key, <code>blSrcGen</code> will rebuild the
source directory.  This can be used, for example, to restore an earlier
version of a source tree or to switch to another branch.</p>

<pre><code>usage: blSrcGen [-h] [-b LISTFILE] [-f] [-j] [-r ROOTDIR] [-T] [-t TITLE]
                [-u UDIR] [-v]

given a build list and uDir, regenerate the root directory

optional arguments:
  -h, --help            show this help message and exit
  -b LISTFILE, --listFile LISTFILE
                        root directory for build list
  -f, --force           do it despite objections
  -j, --justShow        show options and exit
  -r ROOTDIR, --rootDir ROOTDIR
                        root directory for build list (REQUIRED)
  -T, --testing         this is a test run
  -t TITLE, --title TITLE
                        title for build list
  -u UDIR, --uDir UDIR  path to uDir (relative to tmp/ if testing)
  -v, --verbose         be chatty
</code></pre>

<h2>Project Status</h2>

<p>A good beta.</p>

<h2>Licensing</h2>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />The material on this github.io website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
<p>Project software is licensed under an MIT license.
Follow the SOFTWARE LICENSE link below for more information on project software licensing.</p>  <div class="f">
    <hr />
    <div class="license">
      <p><a href="LICENSE.html">SOFTWARE LICENSE</a></p>
    </div>
    <div class="project">
      github <a href="https://github.com/jddixon/buildList">      <img src="img/GitHub-Mark-32px.png" 
        alt="link to project"  
        style="display: inline-block; margin-left: 0 auto; margin-right: 0 auto">
       </a> project
    </div>
    <div class="logo" >
      <a href="https://jddixon.github.io/xlattice/">
      <img src="img/xlattice-2014.jpg" alt="the XLattice Project" style="float: right;" >
      </a>
    </div>
  </div>
</div>
</body>
</html>
